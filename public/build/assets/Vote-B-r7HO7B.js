import{d as L,g as $,u as H,a as Y,r as j,j as r,H as G,e as k}from"./app-DvqN5tN9.js";import{A as z}from"./AuthenticatedLayout-DTMwTJmp.js";var P={exports:{}},D=P.exports,I;function J(){return I||(I=1,(function(S,U){(function(w,v){S.exports=v(L())})(D,function(N){return(function(w){var v={};function f(n){if(v[n])return v[n].exports;var u=v[n]={i:n,l:!1,exports:{}};return w[n].call(u.exports,u,u.exports,f),u.l=!0,u.exports}return f.m=w,f.c=v,f.d=function(n,u,g){f.o(n,u)||Object.defineProperty(n,u,{enumerable:!0,get:g})},f.r=function(n){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(n,"__esModule",{value:!0})},f.t=function(n,u){if(u&1&&(n=f(n)),u&8||u&4&&typeof n=="object"&&n&&n.__esModule)return n;var g=Object.create(null);if(f.r(g),Object.defineProperty(g,"default",{enumerable:!0,value:n}),u&2&&typeof n!="string")for(var M in n)f.d(g,M,(function(x){return n[x]}).bind(null,M));return g},f.n=function(n){var u=n&&n.__esModule?function(){return n.default}:function(){return n};return f.d(u,"a",u),u},f.o=function(n,u){return Object.prototype.hasOwnProperty.call(n,u)},f.p="",f(f.s="./src/react-webcam.tsx")})({"./src/react-webcam.tsx":(function(w,v,f){f.r(v);var n=f("react"),u=(function(){var d=function(a,e){return d=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,s){t.__proto__=s}||function(t,s){for(var i in s)s.hasOwnProperty(i)&&(t[i]=s[i])},d(a,e)};return function(a,e){d(a,e);function t(){this.constructor=a}a.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}})(),g=function(){return g=Object.assign||function(d){for(var a,e=1,t=arguments.length;e<t;e++){a=arguments[e];for(var s in a)Object.prototype.hasOwnProperty.call(a,s)&&(d[s]=a[s])}return d},g.apply(this,arguments)},M=function(d,a){var e={};for(var t in d)Object.prototype.hasOwnProperty.call(d,t)&&a.indexOf(t)<0&&(e[t]=d[t]);if(d!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,t=Object.getOwnPropertySymbols(d);s<t.length;s++)a.indexOf(t[s])<0&&Object.prototype.propertyIsEnumerable.call(d,t[s])&&(e[t[s]]=d[t[s]]);return e};(function(){typeof window>"u"||(navigator.mediaDevices===void 0&&(navigator.mediaDevices={}),navigator.mediaDevices.getUserMedia===void 0&&(navigator.mediaDevices.getUserMedia=function(a){var e=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia;return e?new Promise(function(t,s){e.call(navigator,a,t,s)}):Promise.reject(new Error("getUserMedia is not implemented in this browser"))}))})();function x(){return!!(navigator.mediaDevices&&navigator.mediaDevices.getUserMedia)}var C=(function(d){u(a,d);function a(e){var t=d.call(this,e)||this;return t.canvas=null,t.ctx=null,t.requestUserMediaId=0,t.unmounted=!1,t.state={hasUserMedia:!1},t}return a.prototype.componentDidMount=function(){var e=this,t=e.state,s=e.props;if(this.unmounted=!1,!x()){s.onUserMediaError("getUserMedia not supported");return}t.hasUserMedia||this.requestUserMedia(),s.children&&typeof s.children!="function"&&console.warn("children must be a function")},a.prototype.componentDidUpdate=function(e){var t=this.props;if(!x()){t.onUserMediaError("getUserMedia not supported");return}var s=JSON.stringify(e.audioConstraints)!==JSON.stringify(t.audioConstraints),i=JSON.stringify(e.videoConstraints)!==JSON.stringify(t.videoConstraints),p=e.minScreenshotWidth!==t.minScreenshotWidth,h=e.minScreenshotHeight!==t.minScreenshotHeight;(i||p||h)&&(this.canvas=null,this.ctx=null),(s||i)&&(this.stopAndCleanup(),this.requestUserMedia())},a.prototype.componentWillUnmount=function(){this.unmounted=!0,this.stopAndCleanup()},a.stopMediaStream=function(e){e&&(e.getVideoTracks&&e.getAudioTracks?(e.getVideoTracks().map(function(t){e.removeTrack(t),t.stop()}),e.getAudioTracks().map(function(t){e.removeTrack(t),t.stop()})):e.stop())},a.prototype.stopAndCleanup=function(){var e=this.state;e.hasUserMedia&&(a.stopMediaStream(this.stream),e.src&&window.URL.revokeObjectURL(e.src))},a.prototype.getScreenshot=function(e){var t=this,s=t.state,i=t.props;if(!s.hasUserMedia)return null;var p=this.getCanvas(e);return p&&p.toDataURL(i.screenshotFormat,i.screenshotQuality)},a.prototype.getCanvas=function(e){var t=this,s=t.state,i=t.props;if(!this.video||!s.hasUserMedia||!this.video.videoHeight)return null;if(!this.ctx){var p=this.video.videoWidth,h=this.video.videoHeight;if(!this.props.forceScreenshotSourceSize){var l=p/h;p=i.minScreenshotWidth||this.video.clientWidth,h=p/l,i.minScreenshotHeight&&h<i.minScreenshotHeight&&(h=i.minScreenshotHeight,p=h*l)}this.canvas=document.createElement("canvas"),this.canvas.width=e?.width||p,this.canvas.height=e?.height||h,this.ctx=this.canvas.getContext("2d")}var b=this,m=b.ctx,c=b.canvas;return m&&c&&(c.width=e?.width||c.width,c.height=e?.height||c.height,i.mirrored&&(m.translate(c.width,0),m.scale(-1,1)),m.imageSmoothingEnabled=i.imageSmoothing,m.drawImage(this.video,0,0,e?.width||c.width,e?.height||c.height),i.mirrored&&(m.scale(-1,1),m.translate(-c.width,0))),c},a.prototype.requestUserMedia=function(){var e=this,t=this.props,s=function(h,l){var b={video:typeof l<"u"?l:!0};t.audio&&(b.audio=typeof h<"u"?h:!0),e.requestUserMediaId++;var m=e.requestUserMediaId;navigator.mediaDevices.getUserMedia(b).then(function(c){e.unmounted||m!==e.requestUserMediaId?a.stopMediaStream(c):e.handleUserMedia(null,c)}).catch(function(c){e.handleUserMedia(c)})};if("mediaDevices"in navigator)s(t.audioConstraints,t.videoConstraints);else{var i=function(h){return{optional:[{sourceId:h}]}},p=function(h){var l=h.deviceId;return typeof l=="string"?l:Array.isArray(l)&&l.length>0?l[0]:typeof l=="object"&&l.ideal?l.ideal:null};MediaStreamTrack.getSources(function(h){var l=null,b=null;h.forEach(function(y){y.kind==="audio"?l=y.id:y.kind==="video"&&(b=y.id)});var m=p(t.audioConstraints);m&&(l=m);var c=p(t.videoConstraints);c&&(b=c),s(i(l),i(b))})}},a.prototype.handleUserMedia=function(e,t){var s=this.props;if(e||!t){this.setState({hasUserMedia:!1}),s.onUserMediaError(e);return}this.stream=t;try{this.video&&(this.video.srcObject=t),this.setState({hasUserMedia:!0})}catch{this.setState({hasUserMedia:!0,src:window.URL.createObjectURL(t)})}s.onUserMedia(t)},a.prototype.render=function(){var e=this,t=this,s=t.state,i=t.props,p=i.audio;i.forceScreenshotSourceSize;var h=i.disablePictureInPicture;i.onUserMedia,i.onUserMediaError,i.screenshotFormat,i.screenshotQuality,i.minScreenshotWidth,i.minScreenshotHeight,i.audioConstraints,i.videoConstraints,i.imageSmoothing;var l=i.mirrored,b=i.style,m=b===void 0?{}:b,c=i.children,y=M(i,["audio","forceScreenshotSourceSize","disablePictureInPicture","onUserMedia","onUserMediaError","screenshotFormat","screenshotQuality","minScreenshotWidth","minScreenshotHeight","audioConstraints","videoConstraints","imageSmoothing","mirrored","style","children"]),O=l?g(g({},m),{transform:(m.transform||"")+" scaleX(-1)"}):m,_={getScreenshot:this.getScreenshot.bind(this)};return n.createElement(n.Fragment,null,n.createElement("video",g({autoPlay:!0,disablePictureInPicture:h,src:s.src,muted:!p,playsInline:!0,ref:function(T){e.video=T},style:O},y)),c&&c(_))},a.defaultProps={audio:!1,disablePictureInPicture:!1,forceScreenshotSourceSize:!1,imageSmoothing:!0,mirrored:!1,onUserMedia:function(){},onUserMediaError:function(){},screenshotFormat:"image/webp",screenshotQuality:.92},a})(n.Component);v.default=C}),react:(function(w,v){w.exports=N})}).default})})(P)),P.exports}var Q=J();const B=$(Q);function Z({election:S,candidates:U,hasVoted:N}){const{data:w,setData:v,post:f,processing:n,errors:u}=H({candidate_id:"",live_photo:null}),{auth:g}=Y().props;(()=>{const o=g.user?.role||"";return o==="super_admin"?"state":o.includes("district")&&!o.includes("member")?"district":o.includes("tehsil")&&!o.includes("member")?"tehsil":"member"})();const[x,C]=j.useState(null),[d,a]=j.useState(1),[e,t]=j.useState(""),[s,i]=j.useState(!1),[p,h]=j.useState(!1),[l,b]=j.useState(null),[m,c]=j.useState(!1),y=j.useRef(null);j.useEffect(()=>{a(1),i(!1),h(!1),b(null),c(!1),C(null),t("")},[]);const O=async()=>{try{(await k.post(route("elections.vote.request-otp",S.id))).data.success&&(i(!0),a(2),alert("OTP sent to your registered email address"))}catch(o){alert(o.response?.data?.error||"Failed to send OTP")}},_=async()=>{try{(await k.post(route("elections.vote.verify-otp",S.id),{otp:e})).data.verified&&(h(!0),a(3))}catch(o){alert(o.response?.data?.error||"Invalid OTP")}},T=()=>{if(!p){alert("Please verify OTP first"),a(1);return}const o=y.current.getScreenshot();b(o),c(!1),a(4)},q=()=>{b(null),c(!0),a(3)},F=async o=>{if(o.preventDefault(),!x){alert("Please select a candidate");return}if(!l){alert("Please capture your photo");return}if(!confirm(`Confirm your vote for ${x.member.name}?

This action cannot be undone.`))return;const A=await(await fetch(l)).blob(),E=new FormData;E.append("candidate_id",x.id),E.append("live_photo",A,"live-photo.jpg");try{await k.post(route("elections.vote.submit",S.id),E,{headers:{"Content-Type":"multipart/form-data"}}),window.location.href=route("dashboard")+"?vote_cast=1"}catch(V){alert(V.response?.data?.message||"Failed to submit vote")}},W=o=>{C(o),v("candidate_id",o.id)};return r.jsxs(z,{children:[r.jsx(G,{title:"Cast Your Vote"}),r.jsx("div",{className:"min-h-screen bg-gray-50 py-12",children:r.jsx("div",{className:"max-w-4xl mx-auto px-4",children:N?r.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-green-200 p-8 text-center",children:[r.jsx("div",{className:"w-20 h-20 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-6",children:r.jsx("span",{className:"text-4xl",children:"âœ…"})}),r.jsx("h2",{className:"text-3xl font-bold text-gray-900 mb-4",children:"You have cast your vote"}),r.jsx("p",{className:"text-lg text-gray-600 mb-8 max-w-lg mx-auto",children:"Thank you! Your vote has been submitted for verification."}),r.jsx("a",{href:route("dashboard"),className:"inline-block px-8 py-3 bg-blue-600 text-white rounded-lg font-bold hover:bg-blue-700 transition",children:"Back to Dashboard"})]}):r.jsxs(r.Fragment,{children:[r.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6 mb-6",children:r.jsx("div",{className:"flex items-center justify-between",children:[{num:1,label:"Request OTP"},{num:2,label:"Verify OTP"},{num:3,label:"Capture Photo"},{num:4,label:"Cast Vote"}].map((o,R)=>r.jsxs("div",{className:"flex items-center",children:[r.jsx("div",{className:`flex items-center justify-center w-10 h-10 rounded-full font-bold ${d>=o.num?"bg-blue-600 text-white":"bg-gray-200 text-gray-600"}`,children:d>o.num?"âœ“":o.num}),r.jsx("span",{className:`ml-2 text-sm font-medium ${d>=o.num?"text-blue-600":"text-gray-600"}`,children:o.label}),R<3&&r.jsx("div",{className:`w-12 h-1 mx-2 ${d>o.num?"bg-blue-600":"bg-gray-200"}`})]},o.num))})}),d===1&&r.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-8",children:[r.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-4",children:"Step 1: Verify Your Identity"}),r.jsx("p",{className:"text-gray-600 mb-6",children:"To ensure secure voting, we'll send an OTP to your registered email address."}),r.jsx("button",{onClick:O,className:"px-8 py-4 bg-blue-600 text-white rounded-lg font-bold hover:bg-blue-700 transition",children:"Send OTP"})]}),d===2&&r.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-8",children:[r.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-4",children:"Step 2: Enter OTP"}),r.jsx("p",{className:"text-gray-600 mb-6",children:"Enter the 6-digit OTP sent to your email address"}),r.jsx("input",{type:"text",value:e,onChange:o=>t(o.target.value),maxLength:6,placeholder:"Enter 6-digit OTP",className:"w-full px-4 py-3 border border-gray-300 rounded-lg text-lg font-mono mb-4"}),r.jsxs("div",{className:"flex gap-4",children:[r.jsx("button",{onClick:_,disabled:e.length!==6,className:"px-8 py-3 bg-blue-600 text-white rounded-lg font-semibold hover:bg-blue-700 disabled:bg-gray-400",children:"Verify OTP"}),r.jsx("button",{onClick:O,className:"px-6 py-3 bg-gray-200 text-gray-700 rounded-lg font-semibold hover:bg-gray-300",children:"Resend OTP"})]})]}),d===3&&r.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-8",children:p?r.jsxs(r.Fragment,{children:[r.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-4",children:"Step 3: Capture Your Photo"}),r.jsx("p",{className:"text-gray-600 mb-6",children:"Take a clear selfie for verification by the Election Commission"}),!l&&!m&&r.jsx("button",{onClick:()=>c(!0),className:"px-8 py-4 bg-blue-600 text-white rounded-lg font-bold hover:bg-blue-700 transition",children:"Open Camera"}),m&&r.jsxs("div",{className:"space-y-4",children:[r.jsx(B,{audio:!1,ref:y,screenshotFormat:"image/jpeg",className:"w-full rounded-lg border-4 border-blue-600"}),r.jsx("button",{onClick:T,className:"w-full px-8 py-4 bg-green-600 text-white rounded-lg font-bold hover:bg-green-700 transition",children:"ðŸ“¸ Capture Photo"})]}),l&&!m&&r.jsxs("div",{className:"space-y-4",children:[r.jsx("img",{src:l,alt:"Captured",className:"w-full rounded-lg border-4 border-green-600"}),r.jsxs("div",{className:"flex gap-4",children:[r.jsx("button",{onClick:()=>a(4),className:"flex-1 px-6 py-3 bg-blue-600 text-white rounded-lg font-semibold hover:bg-blue-700",children:"Use This Photo"}),r.jsx("button",{onClick:q,className:"flex-1 px-6 py-3 bg-gray-200 text-gray-700 rounded-lg font-semibold hover:bg-gray-300",children:"Retake"})]})]})]}):r.jsxs("div",{className:"text-center py-8",children:[r.jsx("p",{className:"text-red-600 font-semibold mb-4",children:"âš ï¸ OTP verification required"}),r.jsx("button",{onClick:()=>a(1),className:"px-6 py-3 bg-blue-600 text-white rounded-lg font-semibold",children:"Go to OTP Verification"})]})}),d===4&&!N&&r.jsxs("form",{onSubmit:F,className:"space-y-6",children:[r.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:[r.jsx("p",{className:"text-sm text-green-800 font-semibold mb-2",children:"âœ“ Photo Captured"}),r.jsx("img",{src:l,alt:"Your photo",className:"w-32 h-32 rounded-lg border-2 border-green-600 object-cover"})]}),r.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[r.jsx("h2",{className:"text-xl font-bold text-gray-900 mb-6",children:"Step 4: Select Your Candidate"}),U.length===0?r.jsx("p",{className:"text-center text-gray-500 py-8",children:"No approved candidates available"}):r.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:U.map(o=>r.jsxs("div",{onClick:()=>W(o),className:`cursor-pointer rounded-lg border-2 p-4 transition-all hover:shadow-md flex items-center gap-4 ${x?.id===o.id?"border-blue-600 bg-blue-50 ring-2 ring-blue-200":"border-gray-200 hover:border-blue-300"}`,children:[r.jsx("div",{className:"w-16 h-16 rounded-full bg-gray-200 flex-shrink-0 overflow-hidden",children:o.member?.photo_path?r.jsx("img",{src:`/storage/${o.member.photo_path}`,alt:o.member.name,className:"w-full h-full object-cover"}):r.jsx("div",{className:"w-full h-full flex items-center justify-center text-gray-500 font-bold text-xl",children:o.member?.name?.charAt(0)})}),r.jsxs("div",{className:"flex-1",children:[r.jsx("h3",{className:"font-bold text-gray-900",children:o.member?.name}),r.jsx("p",{className:"text-sm text-gray-600",children:o.member?.designation||"Candidate"})]}),r.jsx("div",{className:`w-6 h-6 rounded-full border-2 flex items-center justify-center ${x?.id===o.id?"border-blue-600 bg-blue-600":"border-gray-300"}`,children:x?.id===o.id&&r.jsx("div",{className:"w-2.5 h-2.5 rounded-full bg-white"})})]},o.id))})]}),r.jsx("button",{type:"submit",disabled:n||!x,className:"w-full py-4 bg-green-600 text-white rounded-lg font-bold text-lg hover:bg-green-700 transition disabled:opacity-50 shadow-lg hover:shadow-xl transform hover:-translate-y-0.5",children:n?"Submitting Vote...":"âœ… CONFIRM & CAST VOTE"})]})]})})})]})}export{Z as default};
