import{a as H,u as R,r as n,j as e,H as U,L as G}from"./app-XCtiZVKQ.js";import{A as B}from"./AuthenticatedLayout-CTGkoCvp.js";function K({states:J,districts:_,tehsils:w,departments:c,authScope:d}){const{auth:C}=H().props,{data:l,setData:a,post:D,processing:x,errors:s}=R({tehsil_id:"",department_id:"",employee_category_id:"",designation_id:"",member_status:"Member",name:"",parentage:"",photo:null,dob:"",contact_email:"",contact_phone:"",school_name:"",union_join_date:""}),[o,g]=n.useState(""),[h,k]=n.useState(null),[u,p]=n.useState("School"),[P,b]=n.useState([]),[L,m]=n.useState([]),[j,f]=n.useState(!1),[y,v]=n.useState(!1);n.useEffect(()=>{d?.district_id&&g(d.district_id),d?.tehsil_id&&a("tehsil_id",d.tehsil_id)},[d]);const S=t=>{g(t),a("tehsil_id","")},q=t=>{const r=t.target.files[0];r&&(a("photo",r),k(URL.createObjectURL(r)))},E=async t=>{a("department_id",t),a("employee_category_id",""),a("designation_id",""),b([]),m([]);const r=c.find(i=>i.id==t);if(r&&r.posting_label?p(r.posting_label):p("School"),t){f(!0);try{const i=await fetch(`/api/departments/${t}/categories`);if(!i.ok){const N=await i.json();throw console.error("API Error:",N),new Error(N.error||"Failed to fetch categories")}const $=await i.json();b($)}catch(i){console.error("Error fetching categories:",i),alert(`Error loading categories: ${i.message}`)}finally{f(!1)}}},A=async t=>{if(a("employee_category_id",t),a("designation_id",""),m([]),t){v(!0);try{const i=await(await fetch(`/api/categories/${t}/designations`)).json();m(i)}catch(r){console.error("Error fetching designations:",r)}finally{v(!1)}}},M=t=>{t.preventDefault(),D(route("tehsil.members.store"),{forceFormData:!0})},F=o?w.filter(t=>t.district_id==o):[];return e.jsxs(B,{user:C.user,header:"Add New Member",children:[e.jsx(U,{title:"Add Member"}),e.jsx("div",{className:"py-6",children:e.jsx("div",{className:"max-w-4xl mx-auto",children:e.jsx("div",{className:"bg-white rounded-lg shadow p-6",children:e.jsxs("form",{onSubmit:M,className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Member Photo"}),e.jsxs("div",{className:"flex items-center gap-4",children:[h&&e.jsx("img",{src:h,alt:"Preview",className:"w-24 h-24 object-cover rounded-lg border-2 border-gray-300"}),e.jsx("input",{type:"file",accept:"image/*",onChange:q,className:"block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-lg file:border-0 file:text-sm file:font-semibold file:bg-union-primary file:text-white hover:file:bg-red-700"})]}),s.photo&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:s.photo})]}),e.jsxs("div",{className:"border-t pt-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-4",children:"Personal Information"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Full Name ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",value:l.name,onChange:t=>a("name",t.target.value),className:"w-full border-gray-300 rounded-lg",required:!0}),s.name&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:s.name})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Parentage (Father/Mother/Guardian) ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",value:l.parentage,onChange:t=>a("parentage",t.target.value),className:"w-full border-gray-300 rounded-lg",required:!0}),s.parentage&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:s.parentage})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Date of Birth"}),e.jsx("input",{type:"date",value:l.dob,onChange:t=>a("dob",t.target.value),className:"w-full border-gray-300 rounded-lg"}),s.dob&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:s.dob})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Email ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"email",value:l.contact_email,onChange:t=>a("contact_email",t.target.value),className:"w-full border-gray-300 rounded-lg",required:!0}),s.contact_email&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:s.contact_email})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Phone (10 digits) ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",value:l.contact_phone,onChange:t=>{const r=t.target.value.replace(/\D/g,"").slice(0,10);a("contact_phone",r)},className:"w-full border-gray-300 rounded-lg",maxLength:10,pattern:"\\d{10}",title:"Please enter exactly 10 digits",required:!0}),s.contact_phone&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:s.contact_phone})]})]})]}),e.jsxs("div",{className:"border-t pt-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-4",children:"Location"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["District ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{value:o,onChange:t=>S(t.target.value),className:"w-full border-gray-300 rounded-lg disabled:bg-gray-100",required:!0,disabled:!!d?.district_id,children:[e.jsx("option",{value:"",children:"Select District"}),_.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["tehsil ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{value:l.tehsil_id,onChange:t=>a("tehsil_id",t.target.value),className:"w-full border-gray-300 rounded-lg disabled:bg-gray-100",disabled:!o||!!d?.tehsil_id,required:!0,children:[e.jsx("option",{value:"",children:"Select tehsil"}),F.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]}),s.tehsil_id&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:s.tehsil_id})]})]})]}),e.jsxs("div",{className:"border-t pt-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-4",children:"Professional Information"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"md:col-span-2 grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Department ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{value:l.department_id,onChange:t=>E(t.target.value),className:"w-full border-gray-300 rounded-lg",required:!0,children:[e.jsx("option",{value:"",children:"Select Department"}),c&&c.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]}),s.department_id&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:s.department_id})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Employee Category ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{value:l.employee_category_id,onChange:t=>A(t.target.value),className:"w-full border-gray-300 rounded-lg",required:!0,disabled:!l.department_id||j,children:[e.jsx("option",{value:"",children:j?"Loading...":"Select Category"}),P.map(t=>e.jsxs("option",{value:t.id,children:[t.name," (",t.code,")"]},t.id))]}),s.employee_category_id&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:s.employee_category_id})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Designation ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{value:l.designation_id,onChange:t=>a("designation_id",t.target.value),className:"w-full border-gray-300 rounded-lg",required:!0,disabled:!l.employee_category_id||y,children:[e.jsx("option",{value:"",children:y?"Loading...":"Select Designation"}),L.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]}),s.designation_id&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:s.designation_id})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Place of Posting / ",u," ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",value:l.school_name,onChange:t=>a("school_name",t.target.value),className:"w-full border-gray-300 rounded-lg",required:!0,placeholder:`e.g. Govt High ${u} Srinagar`}),s.school_name&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:s.school_name})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Union Join Date ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"date",value:l.union_join_date,onChange:t=>a("union_join_date",t.target.value),className:"w-full border-gray-300 rounded-lg",required:!0}),s.union_join_date&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:s.union_join_date})]})]})]}),e.jsxs("div",{className:"flex justify-end gap-4 border-t pt-6",children:[e.jsx(G,{href:route("tehsil.members.index"),className:"px-6 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:x,className:"px-6 py-2 bg-union-primary text-white rounded-lg hover:bg-red-700 transition disabled:opacity-50",children:x?"Creating...":"Create Member"})]})]})})})})]})}export{K as default};
