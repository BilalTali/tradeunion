import{a as G,u as B,r as n,j as e,H as J,L as O}from"./app-XCtiZVKQ.js";import{A as Z}from"./AuthenticatedLayout-CTGkoCvp.js";function X({member:a,states:K,districts:C,tehsils:D,departments:c,authScope:d}){const{auth:P}=G().props,m=d?.role||"member",u=m?m==="super_admin"?"state":m.includes("district")?"district":m.toLowerCase().includes("tehsil")?"tehsil":"member":"member",M=()=>{const t=a.user?.role||"member";return{member:"Member",tehsil_member:"Tehsil Member",district_member:"District Member",state_member:"State Member"}[t]||"Member"},{data:r,setData:i,post:S,processing:p,errors:s}=B({_method:"PUT",tehsil_id:a.tehsil_id||"",department_id:a.department_id||"",employee_category_id:a.employee_category_id||"",designation_id:a.designation_id||"",member_status:M(),name:a.name||"",parentage:a.parentage||"",photo:null,dob:a.dob?a.dob.split("T")[0].substring(0,10):"",contact_email:a.contact_email||"",contact_phone:a.contact_phone||"",school_name:a.school_name||"",union_join_date:a.union_join_date?a.union_join_date.split("T")[0].substring(0,10):""}),[g,b]=n.useState(a.tehsil?.district_id||""),[j,k]=n.useState(a.photo_path?`/storage/${a.photo_path}`:null),L=()=>c.find(l=>l.id==a.department_id)?.posting_label||"School",[_,f]=n.useState(L()),[E,h]=n.useState([]),[q,x]=n.useState([]),[y,v]=n.useState(!1),[N,w]=n.useState(!1);n.useEffect(()=>{d?.district_id&&b(d.district_id),d?.tehsil_id&&i("tehsil_id",d.tehsil_id)},[d]);const $=t=>{b(t),i("tehsil_id","")},T=t=>{const l=t.target.files[0];l&&(i("photo",l),k(URL.createObjectURL(l)))},R=async t=>{i("department_id",t),i("employee_category_id",""),i("designation_id",""),h([]),x([]);const l=c.find(o=>o.id==t);if(l&&l.posting_label?f(l.posting_label):f("School"),t){v(!0);try{const H=await(await fetch(`/api/departments/${t}/categories`)).json();h(H)}catch(o){console.error("Error fetching categories:",o)}finally{v(!1)}}},A=async t=>{if(i("employee_category_id",t),i("designation_id",""),x([]),t){w(!0);try{const o=await(await fetch(`/api/categories/${t}/designations`)).json();x(o)}catch(l){console.error("Error fetching designations:",l)}finally{w(!1)}}};n.useEffect(()=>{a.department_id&&fetch(`/api/departments/${a.department_id}/categories`).then(t=>t.json()).then(t=>h(t)).catch(t=>console.error("Error loading categories:",t)),a.employee_category_id&&fetch(`/api/categories/${a.employee_category_id}/designations`).then(t=>t.json()).then(t=>x(t)).catch(t=>console.error("Error loading designations:",t))},[]);const F=t=>{t.preventDefault(),S(route(`${u}.members.update`,a.id),{forceFormData:!0})},U=g?D.filter(t=>t.district_id==g):[];return e.jsxs(Z,{user:P.user,header:"Edit Member",children:[e.jsx(J,{title:"Edit Member"}),e.jsx("div",{className:"py-6",children:e.jsx("div",{className:"max-w-4xl mx-auto",children:e.jsx("div",{className:"bg-white rounded-lg shadow p-6",children:e.jsxs("form",{onSubmit:F,className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Member Photo"}),e.jsxs("div",{className:"flex items-center gap-4",children:[j&&e.jsx("img",{src:j,alt:"Preview",className:"w-24 h-24 object-cover rounded-lg border-2 border-gray-300"}),e.jsx("input",{type:"file",accept:"image/*",onChange:T,className:"block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-lg file:border-0 file:text-sm file:font-semibold file:bg-union-primary file:text-white hover:file:bg-red-700"})]}),s.photo&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:s.photo})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Member Status ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{value:r.member_status,onChange:t=>i("member_status",t.target.value),className:"w-full border-gray-300 rounded-lg",required:!0,children:[e.jsx("option",{value:"Member",children:"Member"}),e.jsx("option",{value:"Tehsil Member",children:"Tehsil Member"}),e.jsx("option",{value:"District Member",children:"District Member"}),e.jsx("option",{value:"State Member",children:"State Member"})]}),s.member_status&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:s.member_status})]}),e.jsxs("div",{className:"border-t pt-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-4",children:"Personal Information"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Full Name ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",value:r.name,onChange:t=>i("name",t.target.value),className:"w-full border-gray-300 rounded-lg",required:!0}),s.name&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:s.name})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Parentage (Father/Mother/Guardian) ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",value:r.parentage,onChange:t=>i("parentage",t.target.value),className:"w-full border-gray-300 rounded-lg",required:!0}),s.parentage&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:s.parentage})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Date of Birth"}),e.jsx("input",{type:"date",value:r.dob,onChange:t=>i("dob",t.target.value),className:"w-full border-gray-300 rounded-lg"}),s.dob&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:s.dob})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Email"}),e.jsx("input",{type:"email",value:r.contact_email,onChange:t=>i("contact_email",t.target.value),className:"w-full border-gray-300 rounded-lg"}),s.contact_email&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:s.contact_email})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Phone"}),e.jsx("input",{type:"text",value:r.contact_phone,onChange:t=>{const l=t.target.value.replace(/\D/g,"").slice(0,10);i("contact_phone",l)},className:"w-full border-gray-300 rounded-lg",maxLength:10,pattern:"\\d{10}",title:"Please enter exactly 10 digits"}),s.contact_phone&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:s.contact_phone})]})]})]}),e.jsxs("div",{className:"border-t pt-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-4",children:"Location"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["District ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{value:g,onChange:t=>$(t.target.value),className:"w-full border-gray-300 rounded-lg disabled:bg-gray-100",required:!0,disabled:!!d?.district_id,children:[e.jsx("option",{value:"",children:"Select District"}),C.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["tehsil ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{value:r.tehsil_id,onChange:t=>i("tehsil_id",t.target.value),className:"w-full border-gray-300 rounded-lg disabled:bg-gray-100",disabled:!g||!!d?.tehsil_id,required:!0,children:[e.jsx("option",{value:"",children:"Select tehsil"}),U.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]}),s.tehsil_id&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:s.tehsil_id})]})]})]}),e.jsxs("div",{className:"border-t pt-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-4",children:"Professional Information"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"md:col-span-2 grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Department ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{value:r.department_id,onChange:t=>R(t.target.value),className:"w-full border-gray-300 rounded-lg",required:!0,children:[e.jsx("option",{value:"",children:"Select Department"}),c&&c.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]}),s.department_id&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:s.department_id})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Employee Category ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{value:r.employee_category_id,onChange:t=>A(t.target.value),className:"w-full border-gray-300 rounded-lg",required:!0,disabled:!r.department_id||y,children:[e.jsx("option",{value:"",children:y?"Loading...":"Select Category"}),E.map(t=>e.jsxs("option",{value:t.id,children:[t.name," (",t.code,")"]},t.id))]}),s.employee_category_id&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:s.employee_category_id})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Designation ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{value:r.designation_id,onChange:t=>i("designation_id",t.target.value),className:"w-full border-gray-300 rounded-lg",required:!0,disabled:!r.employee_category_id||N,children:[e.jsx("option",{value:"",children:N?"Loading...":"Select Designation"}),q.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]}),s.designation_id&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:s.designation_id})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Place of Posting / ",_," ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",value:r.school_name,onChange:t=>i("school_name",t.target.value),className:"w-full border-gray-300 rounded-lg",required:!0,placeholder:`e.g. Govt High ${_} Srinagar`}),s.school_name&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:s.school_name})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Union Join Date ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"date",value:r.union_join_date,onChange:t=>i("union_join_date",t.target.value),className:"w-full border-gray-300 rounded-lg",required:!0}),s.union_join_date&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:s.union_join_date})]})]})]}),e.jsxs("div",{className:"flex justify-end gap-4 border-t pt-6",children:[e.jsx(O,{href:route(`${u}.members.index`),className:"px-6 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:p,className:"px-6 py-2 bg-union-primary text-white rounded-lg hover:bg-red-700 transition disabled:opacity-50",children:p?"Saving...":"Save Changes"})]})]})})})})]})}export{X as default};
